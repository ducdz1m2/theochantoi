<header class="site-header">
  <!-- fontawesome (icon) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/6.6.6/css/flag-icons.min.css">

  <div class="header-wrapper">
    <input type="checkbox" id="nav-trigger" class="nav-checkbox" />
    <label for="nav-trigger" class="menu-label" aria-label="Toggle navigation">
      <span class="menu-icon" aria-hidden="true"></span>
    </label>

    <a class="site-title" rel="author" href="{{ '/' | relative_url }}">{{ site.title | escape }}</a>

    {%- assign default_paths = site.pages | map: "path" -%}
    {%- assign page_paths = site.minima.nav_pages | default: default_paths -%}
    {%- assign page_titles = site.pages | map: 'title' | compact %} 
    {%- unless page_titles == empty %}
    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <ul class="nav-items">
        {% include nav-items.html paths = page_paths %}
      </ul>
    </nav>
    {%- endunless %}

    <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme" aria-pressed="false">
      <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <div class="language-switcher">
      <button class="lang-toggle" aria-label="Đổi ngôn ngữ">
        <span class="fi"></span>
        <i class="fas fa-chevron-down"></i>
      </button>
      <ul class="lang-menu">
        <li data-lang="vi"><span class="fi fi-vn"></span> Tiếng Việt</li>
        <li data-lang="en"><span class="fi fi-gb"></span> English</li>
        <li data-lang="ja"><span class="fi fi-jp"></span> 日本語</li>
        <li data-lang="ko"><span class="fi fi-kr"></span> 한국어</li>
        <li data-lang="fr"><span class="fi fi-fr"></span> Français</li>
        <li data-lang="de"><span class="fi fi-de"></span> Deutsch</li>
      </ul>
    </div>
  </div>

  <link rel="icon" href="{{ '/favicon.ico' | absolute_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  <script src="{{ '/assets/js/theme.js' | relative_url }}" defer></script>

  <script>
document.addEventListener("DOMContentLoaded", function() {
  const switcher = document.querySelector(".language-switcher");
  const toggleBtn = switcher.querySelector(".lang-toggle span.fi");
  const menuItems = switcher.querySelectorAll(".lang-menu li");

  const langMap = {
    'vi': 'vn',
    'en': 'gb',
    'ja': 'jp',
    'ko': 'kr',
    'fr': 'fr',
    'de': 'de'
  };

  function updateFlag(lang) {
    const flag = langMap[lang] || 'gb';
    toggleBtn.className = `fi fi-${flag}`;
  }

  function selectLanguage(lang) {
    updateFlag(lang);
    changeLanguage(lang);
    localStorage.setItem('selectedLang', lang); // lưu lại ngôn ngữ
  }

  // Lấy ngôn ngữ lưu trữ trước tiên, nếu không có thì dùng navigator
  let savedLang = localStorage.getItem('selectedLang');
  let userLang = savedLang || (navigator.language || navigator.userLanguage).slice(0,2);
  if (!langMap[userLang]) userLang = 'en';
  selectLanguage(userLang);

  // Toggle menu
  const toggleButton = switcher.querySelector(".lang-toggle");
  toggleButton.addEventListener("click", () => {
    switcher.classList.toggle("open");
  });

  // Click ra ngoài đóng menu
  document.addEventListener("click", (e) => {
    if (!switcher.contains(e.target)) {
      switcher.classList.remove("open");
    }
  });

  // Chọn ngôn ngữ từ menu
  menuItems.forEach(item => {
    item.addEventListener("click", () => {
      const lang = item.getAttribute("data-lang");
      selectLanguage(lang);
      switcher.classList.remove("open");
    });
  });
});
</script>

</header>
